## tlnts

### Гайд по разработке
Верхне уровневая структура каталогов:
- каждый сервис - отдельный модуль
- для каждого сервиса вынести в отдельный модуль(api) pojo для общения с ним из сервиса агрегации и отправки сообщений в mq
- common - это модуль, который включает утилиты, pojo и классы, которые могут быть включены в контекст в нескольких модулях проекта
- local - директория с конфигом локального деплоя
- k8s - прод делой

Сервисная структура пакетов:
- main - java классы и ресурсы
- test - не думаю что у нас будет время писать тесты
- docker - dockerfile и скрипты к нему
- api/v{1..n} - контроллеры для апи соответствующей версии
- configuration - классы конфигурации контекста, в ней properties - наши кастомные пропсы
- бизнес логика по хранению и обработке данных - пакет storage, который разделен на пакеты по названию сущностей

Gradle
- Корневой build.gradle - настраивает плагины и зависимости для модульных, но добавляя зависимости там, они не инжектнуться в сервисы
- Импорт зависимостей других модулей проекта(common/api/...) делается через api scope `api(project(':{project name}'))`
- Если в сервисе зависимости используются с одинаковой версией, то вынести версию в блок ext
- Если несколько модулей тянут одну версию зависимостей, вынести ее в корневой, для dependency management-а

Пропсы и профили
- Используем профили local и prod
- Общие пропсы для обоих профилей в application.properties
- Специфичные для каждого в application-local.properties и application-prod.properties
- Запустить сервис с конкретным профилем можно через `-Dspring.profiles.active={local|prod}`
- Кастомные пропсы серивса должны начинаться с его имени(например `feed.*`) и писаться в кебаб кейсе

### Гайд по deploy-ю
Локальный деплой(local директория)
- Запускаем скриптик `local/run-local.sh`. Требования - docker и docker-compose
- Если есть ошибки при его выполнении, и они не свзяаны с работой сервиса, то скорее всего нужно почистить данные с
предыдущих билдов `local/nuke-local.sh` или docker образы сервисов `docker rmi ...`
- Дополнять инфраструктурыне компоненты нужно в конфиг `docker-compose-infra.yaml` а микросервисы в `docker-compose-services.yaml`
по аналогии

### Схема компонентов
![arch](https://i.ibb.co/PxWnR6Z/Screen-Shot-2023-05-06-at-15-33-30.png)
